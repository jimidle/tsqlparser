-- SET CURSOR_CLOSE_ON_COMMIT
-------------------------------------------------------------------------------
SET NOCOUNT ON

CREATE TABLE t1 (
	   a INT
)
GO 

INSERT INTO t1 
VALUES (1)
INSERT INTO t1 
VALUES (2)
GO

PRINT '-- SET CURSOR_CLOSE_ON_COMMIT ON'
GO
SET CURSOR_CLOSE_ON_COMMIT ON
GO
PRINT '-- BEGIN TRAN'
BEGIN TRAN
	PRINT '-- Declare and open cursor'
	DECLARE testcursor CURSOR FOR
	SELECT a 
	FROM t1
	OPEN testcursor
	PRINT '-- Commit tran'
	COMMIT TRAN
	PRINT '-- Try to use cursor'
	FETCH NEXT FROM testcursor
	CLOSE testcursor
	DEALLOCATE testcursor
	GO
	PRINT '-- SET CURSOR_CLOSE_ON_COMMIT OFF'
	GO
	SET CURSOR_CLOSE_ON_COMMIT OFF
	GO
	PRINT '-- BEGIN TRAN'
	BEGIN TRAN
		PRINT '-- Declare and open cursor'
		DECLARE testcursor CURSOR FOR
		SELECT a 
		FROM t1
		OPEN testcursor
		PRINT '-- Commit tran'
		COMMIT TRAN
		PRINT '-- Try to use cursor'
		FETCH NEXT FROM testcursor
		CLOSE testcursor
		DEALLOCATE testcursor
		GO
		DROP TABLE t1;
		GO

